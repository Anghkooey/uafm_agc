javascript: (() => { let includeUnscoredTasks = true; let lastWidth = "0px"; const getGradeInfo = (percent) => { if (percent >= 90) return ["5", "darkgreen"]; if (percent >= 80) return ["4.5", "green"]; if (percent >= 70) return ["4", "#66cc66"]; if (percent >= 60) return ["3.5", "#FF8C00"]; if (percent >= 50) return ["3", "orange"]; return ["2", "red"]; }; const updateTable = () => { let totalPoints = 0; let maxPoints = 0; let totalPercentage = 0; let taskCount = 0; let hasUnscoredTasks = false; document.querySelectorAll("li.kraken3-task").forEach((el) => { const type = el.querySelector(".taskType")?.textContent.trim(); if (!type) return; if (type === "Test") { const statusContainer = el.querySelector(".kraken3-task__status_path"); if (!statusContainer) return; const attempts = Array.from(statusContainer.querySelectorAll(".kraken3_task__status_piece")); if (attempts.length === 0) return; const lastAttempt = attempts.at(-1); const details = lastAttempt.querySelector(".listOfValues"); if (!details) return; const passed = details.querySelector("p.typeIfPassed")?.textContent.includes("Zaliczony"); if (!passed) { hasUnscoredTasks = true; if (!includeUnscoredTasks) return; } const maxPtsText = [...details.querySelectorAll("p.typeTitle")].find(p => p.textContent.includes("Punkty do zdobycia") ); const gotPtsText = [...details.querySelectorAll("p.typeTitle")].find(p => p.textContent.includes("Uzyskano łącznie") ); const max = maxPtsText ? parseInt(maxPtsText.textContent.match(/\d+/)?.[0]) : null; const got = gotPtsText ? parseInt(gotPtsText.textContent.match(/\d+/)?.[0]) : null; if (max !== null && got !== null) { if (got === 0) hasUnscoredTasks = true; if (!includeUnscoredTasks && got === 0) return; totalPoints += got; maxPoints += max; totalPercentage += Math.floor((got / max) * 100); taskCount++; } return; } const m = el.querySelector(".kraken3-task__status_path .currentStatus") ?.textContent.match(/(\d+)\s*\/\s*(\d+)\s*pts/); if (m) { const [earned, possible] = [+m[1], +m[2]]; if (earned === 0) hasUnscoredTasks = true; if (!includeUnscoredTasks && earned === 0) return; totalPoints += earned; maxPoints += possible; totalPercentage += Math.floor((earned / possible) * 100); taskCount++; } }); const avg = totalPercentage && taskCount ? Math.round((totalPercentage / taskCount) * 100) / 100 : 0; const [grade, color] = getGradeInfo(avg); const [altGrade, altColor] = getGradeInfo(avg + 5); const showAlt = grade !== altGrade; const gradeDisplay = showAlt ? `<span style="color:${color};display:inline-block;width:45%;text-align:center">${grade}</span> <span style="color:gray;display:inline-block;width:10%;text-align:center">/</span> <span style="color:${altColor};display:inline-block;width:45%;text-align:center">${altGrade}</span>` : `<span style="color:${color};display:inline-block;width:100%;text-align:center">${grade}</span>`; let tbl = document.getElementById("zgm"); if (!tbl) { tbl = document.createElement("table"); tbl.id = "zgm"; const firstTask = document.querySelector(".kraken3-task"); if (firstTask?.parentNode) { firstTask.parentNode.insertBefore(tbl, firstTask); } } tbl.style.cssText = "margin:20px auto;border-collapse:collapse;font:18px 'Roboto',sans-serif;white-space:nowrap;text-align:center"; tbl.innerHTML = taskCount ? ` <thead> <tr style="background:#f1f1f1;color:gray"> <th style="font-weight:bold">Stat</th> <th style="font-weight:bold">Uzyskano</th> <th style="font-weight:bold">Max</th> </tr> </thead> <tbody> <tr> <td style="font-weight:bold">Ocena</td> <td style="font-weight:bold">${gradeDisplay}</td> <td style="font-weight:bold;color:black">5</td> </tr> <tr> <td style="font-weight:bold">pts</td> <td style="font-weight:bold;color:${color}">${totalPoints}</td> <td style="font-weight:bold;color:black">${maxPoints}</td> </tr> <tr> <td style="font-weight:bold">%</td> <td style="font-weight:bold;color:${color}">${avg}%</td> <td style="font-weight:bold;color:black">100%</td> </tr> </tbody>` : ""; tbl.style.display = taskCount ? "table" : "none"; if (taskCount) { tbl.style.width = "auto"; lastWidth = tbl.offsetWidth + "px"; tbl.style.width = lastWidth; } let toggle = document.getElementById("qop"); if (hasUnscoredTasks) { if (!toggle) { toggle = document.createElement("table"); toggle.id = "qop"; toggle.style.cssText = "margin:-20px auto 20px auto;border-collapse:collapse;font:18px 'Roboto',sans-serif"; toggle.innerHTML = ` <tr> <td style="background:#f1f1f1;text-align:center;padding:10px;cursor:pointer;font-weight:bold;color:gray"></td> </tr>`; toggle.querySelector("td").onclick = () => { includeUnscoredTasks = !includeUnscoredTasks; updateTable(); }; tbl.parentNode.insertBefore(toggle, tbl.nextSibling); } toggle.querySelector("td").innerHTML = includeUnscoredTasks ? "Ignoruj nieocenione zadania" : "Uwzględnij nieocenione zadania"; toggle.style.display = "table"; toggle.style.width = lastWidth; } else if (toggle) { toggle.remove(); } }; updateTable(); })(); void 0;